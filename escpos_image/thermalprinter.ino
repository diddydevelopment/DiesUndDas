/*
 Example 38.1 - Sparkfun Thermal Printer Test (COM-10438)
 http://tronixstuff.com/tutorials > chapter 38
 Based on code by Nathan Seidle of Spark Fun Electronics 2011
*/
#include <SoftwareSerial.h>
SoftwareSerial Thermal(11,10);
int heatTime = 80;
int heatInterval = 255;
char printDensity = 15; 
char printBreakTime = 15;
void setup() 
{
 Serial.begin(9600); // for debug info to serial monitor
 Thermal.begin(9600); // to write to our new printer
 initPrinter();
}
void initPrinter()
{
// //Modify the print speed and heat
// Thermal.write(27);
// Thermal.write(55);
// Thermal.write(7); //Default 64 dots = 8*('7'+1)
// Thermal.write(heatTime); //Default 80 or 800us
// Thermal.write(heatInterval); //Default 2 or 20us
// //Modify the print density and timeout
// Thermal.write(18);
// Thermal.write(35);
// int printSetting = (printDensity<<4) | printBreakTime;
// Thermal.write(printSetting); //Combination of printDensity and printBreakTime
// Serial.println();
// Serial.println("Printer ready"); 
}

void sendByte(byte b) {
  Thermal.write(b);
  Serial.println("print byte");
  delay(30);
}

void loop()
{
  //const int lenarr = 16;
  // commandcode commandcode bitmode height(low) height(height) data
  //byte vals[lenarr] = {0x1B, 0x2A, 0x0, 0x0A, 0x0, 128, 64, 32, 16, 8, 4, 2, 1, 2, 4};
  //byte vals2[lenarr] = {0x1B, 0x2A, 0x0, 0x0A, 0x0, 1, 2, 4, 8, 16, 32, 64, 128, 64, 32};
  //byte vals3[lenarr] = {0x1B, 0x2A, 33, 0x02, 0x0, 1, 1, 1, 2, 2, 2};

  //byte escpos[1152] = {170,219,255,85,44,127,171,215,255,84,106,255,175,191,255,81,127,255,191,255,255,67,255,255,191,255,255,101,255,255,155,255,255,109,255,255,146,255,255,109,255,255,151,255,255,105,255,255,159,255,255,97,255,255,191,255,255,69,255,255,187,255,255,87,255,255,171,255,255,87,255,175,187,255,86,71,254,15,187,254,247,79,254,175,179,254,29,79,254,239,183,252,23,79,254,173,183,252,47,79,254,159,191,252,111,79,253,23,191,252,175,79,252,127,191,253,63,79,252,95,183,248,175,79,253,95,191,252,47,79,248,159,191,252,111,79,249,29,191,248,175,95,252,91,175,249,47,95,248,155,191,248,118,95,249,31,191,248,213,95,240,43,191,248,158,127,248,53,191,240,155,127,248,109,191,248,18,127,242,127,191,248,21,127,248,47,255,249,54,127,248,42,255,254,191,127,255,253,255,255,255,255,255,252,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,254,255,255,253,255,255,255,255,255,252,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,239,255,255,191,255,255,251,255,255,255,219,127,255,63,255,93,191,255,255,239,191,251,254,255,95,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,223,255,255,255,255,255,223,255,255,255,255,255,255,255,255,191,255,255,247,255,255,127,255,255,255,255,255,191,255,255,127,255,255,239,255,255,191,255,255,223,255,255,123,255,255,173,126,255,215,215,170,122,186,255,175,239,86,90,176,191,247,109,13,173,212,247,123,106,10,175,189,255,221,107,173,87,222,247,250,181,190,255,255,255,242,251,255,239,79,222,213,187,255,238,95,255,153,191,255,246,255,255,59,255,255,222,255,255,127,255,255,171,223,255,127,255,255,175,255,255,223,63,255,127,223,255,239,255,255,191,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,247,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,223,255,255,190,255,254,247,223,255,191,255,250,222,255,189,247,239,235,95,127,183,255,219,253,85,255,247,255,127,93,191,235,247,213,191,255,191,247,191,246,223,234,159,123,191,123,212,245,173,125,110,223,212,251,181,110,222,94,184,235,181,214,117,219,125,222,182,212,235,93,170,253,182,220,86,219,118,251,182,201,237,91,124,119,173,150,218,214,248,255,59,78,234,213,180,125,190,234,235,83,60,254,173,198,249,182,121,170,219,174,253,45,84,235,214,250,189,59,76,255,213,182,247,46,88,189,219,238,255,53,82,85,174,189,255,245,212,219,91,110,255,238,181,235,117,218,253,191,255,255,219,255,255,253,255,255,254,191,255,255,253,255,254,255,255,255,255,255,255,127,255,255,255,255,255,255,255,255,191,255,255,255,255,255,255,255,255,239,255,255,255,255,255,239,255,255,255,255,255,255,255,255,223,255,255,255,255,255,191,255,255,255,255,255,191,255,255,255,255,255,191,255,255,255,255,255,191,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,253,255,255,253,191,255,253,245,223,254,255,125,253,191,247,253,245,223,254,255,125,253,181,183,254,255,238,253,246,187,254,187,255,254,254,170,254,219,255,254,255,93,254,181,247,254,255,190,254,222,235,255,123,191,254,222,247,255,123,189,254,222,215,248,123,125,245,215,215,194,125,125,40,187,215,147,111,122,72,125,223,165,91,107,18,254,254,168,91,171,69,111,127,34,189,213,148,106,255,73,63,86,162,237,187,20,58,237,73,95,95,146,173,245,68,123,91,153,46,247,66,183,93,168,93,182,18,174,239,165,61,91,72,87,245,34,189,94,148,87,183,73,61,106,164,150,255,18,111,171,201,29,93,36,87,247,146,187,93,73,22,246,36,95,91,146,171,237,73,30,191,36,171,246,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255};

  //byte escpos[576] = {170,219,255,85,44,127,171,215,255,84,106,255,175,191,255,81,127,255,191,255,255,67,255,255,170,219,255,85,44,127,171,215,255,84,106,255,175,191,255,81,127,255,191,255,255,67,255,255,170,219,255,85,44,127,171,215,255,84,106,255,175,191,255,81,127,255,191,255,255,67,255,255,170,219,255,85,44,127,171,215,255,84,106,255,175,191,255,81,127,255,191,255,255,67,255,255,170,219,255,85,44,127,171,215,255,84,106,255,175,191,255,81,127,255,191,255,255,67,255,255,170,219,255,85,44,127,171,215,255,84,106,255,175,191,255,81,127,255,191,255,255,67,255,255,170,219,255,85,44,127,171,215,255,84,106,255,175,191,255,81,127,255,191,255,255,67,255,255,170,219,255,85,44,127,171,215,255,84,106,255,175,191,255,81,127,255,191,255,255,67,255,255,170,219,255,85,44,127,171,215,255,84,106,255,175,191,255,81,127,255,191,255,255,67,255,255,170,219,255,85,44,127,171,215,255,84,106,255,175,191,255,81,127,255,191,255,255,67,255,255,170,219,255,85,44,127,171,215,255,84,106,255,175,191,255,81,127,255,191,255,255,67,255,255,170,219,255,85,44,127,171,215,255,84,106,255,175,191,255,81,127,255,191,255,255,67,255,255,170,219,255,85,44,127,171,215,255,84,106,255,175,191,255,81,127,255,191,255,255,67,255,255,170,219,255,85,44,127,171,215,255,84,106,255,175,191,255,81,127,255,191,255,255,67,255,255,170,219,255,85,44,127,171,215,255,84,106,255,175,191,255,81,127,255,191,255,255,67,255,255,170,219,255,85,44,127,171,215,255,84,106,255,175,191,255,81,127,255,191,255,255,67,255,255,170,219,255,85,44,127,171,215,255,84,106,255,175,191,255,81,127,255,191,255,255,67,255,255,170,219,255,85,44,127,171,215,255,84,106,255,175,191,255,81,127,255,191,255,255,67,255,255,170,219,255,85,44,127,171,215,255,84,106,255,175,191,255,81,127,255,191,255,255,67,255,255,170,219,255,85,44,127,171,215,255,84,106,255,175,191,255,81,127,255,191,255,255,67,255,255,170,219,255,85,44,127,171,215,255,84,106,255,175,191,255,81,127,255,191,255,255,67,255,255,170,219,255,85,44,127,171,215,255,84,106,255,175,191,255,81,127,255,191,255,255,67,255,255,170,219,255,85,44,127,171,215,255,84,106,255,175,191,255,81,127,255,191,255,255,67,255,255,170,219,255,85,44,127,171,215,255,84,106,255,175,191,255,81,127,255,191,255,255,67,255,255};
  //escpos[288] = {175,127,255,81,255,255,191,255,255,95,255,255,191,255,255,111,255,255,159,255,255,127,255,255,159,255,255,111,255,255,191,255,255,95,255,255,191,63,255,95,123,255,190,95,127,127,119,239,190,63,255,126,255,255,190,127,255,126,191,255,190,127,255,126,59,255,190,255,255,124,55,255,190,239,255,124,63,255,254,235,255,124,54,186,252,91,79,126,110,227,252,91,93,254,55,182,255,253,255,255,238,223,255,251,63,255,252,255,255,247,255,255,254,255,255,231,255,255,251,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,254,255,255,255,219,255,254,255,255,255,234,255,254,191,247,127,235,239,254,254,187,255,87,239,95,254,187,254,235,254,222,190,171,233,107,247,100,255,186,170,85,215,209,255,186,100,106,231,170,191,186,209,106,237,100,215,179,170,125,222,209,107,229,164,183,186,210,93,231,101,119,250,168,173,117,100,123,219,178,182,254,196,93,213,187,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255};

  //byte escpos[288] = {255,255,255,255,255,255,255,255,255,255,253,219,255,239,127,255,127,246,255,221,223,250,247,117,223,253,223,254,191,251,235,239,239,255,255,255,149,95,251,239,255,95,187,255,235,69,255,254,191,184,27,78,162,5,188,120,0,240,188,9,96,114,0,192,72,16,128,176,0,192,0,152,0,80,8,161,0,4,0,127,221,170,191,125,65,113,255,148,244,18,235,250,237,189,245,51,247,122,223,255,255,127,255,251,255,255,255,254,255,255,235,255,255,255,255,255,182,255,246,255,253,191,255,255,255,182,255,239,255,255,253,255,254,255,255,255,251,239,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,125,255,255,239,255,255,251,191,255,255,251,255,111,127,254,187,239,235,237,127,190,255,173,247,251,255,90,127,87,239,239,251,187,255,236,254,255,183,87,95,253,189,191,246,247,111,255,94,63,255,235,93,251,255,7,126,253,83,223,255,213,127,247,145,215,255,245,255,255,147,239,255,253,255,255,247,255,191,255,254,239,191,255,255,253,95,255,247,255,247,237,191,255,191,111,254,235,255,255,191,111,255,253,255,255,239,191,255,187,247,255,255,127,255,255,253,255,238,255,255,255,255,255,255,255,255,127,255,255,255,255,255,255,255,255};

const int escpos_len = 672;
const byte escpos[escpos_len] = {255,255,239,253,223,251,255,223,250,255,223,245,255,221,247,186,239,186,239,187,237,190,247,186,205,119,171,220,183,106,213,171,77,179,15,247,28,254,80,188,224,113,192,168,192,160,194,16,192,32,130,72,160,10,160,85,136,98,153,100,155,236,179,221,247,189,238,251,255,239,255,255,239,255,254,255,223,245,191,246,255,219,255,221,247,254,223,245,255,223,251,254,223,247,254,255,255,125,239,255,181,255,111,250,223,245,127,218,239,117,191,213,255,213,127,171,254,171,255,215,126,215,125,223,183,255,110,255,237,182,77,172,46,154,110,31,44,58,69,30,160,28,34,12,161,16,168,5,186,79,55,92,191,104,191,120,247,92,255,185,126,235,254,189,255,117,255,255,247,255,255,255,254,235,191,213,255,93,247,190,239,250,191,237,255,119,221,255,246,223,251,255,255,253,87,255,253,87,254,235,191,237,191,213,255,85,186,111,218,127,235,189,255,235,190,255,250,223,250,173,119,236,255,189,71,33,4,145,0,165,0,73,128,2,40,129,18,4,160,11,32,5,0,81,170,247,91,238,63,211,45,82,165,90,37,218,39,218,191,107,223,255,119,253,255,234,255,173,251,215,125,223,245,95,251,222,247,189,239,255,91,254,183,255,253,175,251,255,255,253,87,255,186,255,171,254,119,221,119,222,123,175,245,158,243,93,246,95,251,175,253,239,191,221,247,93,255,191,95,231,187,68,127,33,95,5,82,11,65,20,66,5,20,5,138,21,141,40,143,216,143,184,207,249,191,91,239,30,235,183,94,183,255,190,245,127,245,223,117,174,251,183,221,118,223,122,239,186,111,253,183,253,223,247,125,223,247,189,255,239,187,255,118,255,255,255,171,254,255,171,255,238,187,255,174,251,95,250,175,253,87,186,239,181,122,215,253,111,218,255,117,222,127,245,223,251,190,255,253,95,251,127,255,173,127,215,122,159,105,31,197,30,171,135,157,175,155,175,182,223,111,191,255,187,255,254,235,149,255,173,118,221,107,190,219,238,123,174,251,174,251,175,253,235,191,221,247,125,223,247,125,223,246,127,223,251,126,239,253,255,255,127,253,239,251,191,255,237,191,251,239,191,246,191,239,122,223,255,170,255,187,110,219,125,175,245,95,171,245,174,81,254,211,189,235,189,214,253,107,255,182,255,214,251,127,214,127,223,123,223,119,222,111,253,191,239,125,219,254,187,255,247,127,239,126,191,239,189,223,191,253,175,255,190,215,255,95,251,111,223,253,87,255,251,95,246,191,255,237,255,187,255,239,254,223,255,255,255,247,190,255,247,191,254,251,223,126,247,253,223,247,189,235,254,171,221,118,219,173,119,218,47,245,94,247,218,127,173,87,250,87,174,251,85,191,235,221,255,170,253,255,175,251,254,111,255,251,255,255,223,253,127,239,189,223,119,253,223,119,221,255,183,253,239,125,255,247,221,255,251,223,255,118,255,191,247,254,191,247,255,223,254,255,189,255,247,191,255,251,255,223,255};
const int width = 96;
const int height = 56;
const int batch_height = 1;

  for(int h=0;h<height/(batch_height*8);++h) {
    sendByte(27);
    sendByte(42);
    sendByte((byte)0);
    sendByte(width);
    sendByte((byte)0);
    for(int w=0;w<batch_height*width;++w) {
      int c = (h*batch_height*width);
      sendByte(escpos[c+w]);
    }
    
  }


//  for(int h = 0;h<height/24;++h) {
//      sendByte(width);
//      sendByte((byte)0x0);
//      for(int w = 0;w<width*3;++w) {
//            sendByte((byte)escpos[h*width*3+w]);
//      }
//  }


  
  //for(int v = 0;v<lenarr;++v) {
  //  Thermal.write(vals[v]);
  //  Serial.write(vals[v]);
  //  delay(5);
  //}

 //Thermal.println("Ich war bei Katha und Chris und es hat mir gefallen!");
 //Thermal.write(10); //Sends the LF to the printer, advances the paper
 //Thermal.print(" Millis = ");
 //Thermal.println(millis()); 
 Thermal.write(10);
 Thermal.write(10);
 Thermal.write(10);
 Thermal.write(10);
 do { } while (1>0);
}
